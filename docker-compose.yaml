livekit:
  image: 'livekit/livekit-server:v1.9.0'
  container_name: livekit_server
  restart: always
  network_mode: "host"
  
  # AÃ‘ADIR ESTO para limitar a IPv4 dentro del contenedor
  sysctls:
    - net.ipv6.conf.all.disable_ipv6=1
    - net.ipv6.conf.default.disable_ipv6=1
  
  environment:
    # Fuerza a usar solo IPv4
    LIVEKIT_BIND_ADDRESS: '0.0.0.0'
    LIVEKIT_API_KEY: '${LIVEKIT_API_KEY}'
    LIVEKIT_API_SECRET: '${LIVEKIT_API_SECRET}'
    LIVEKIT_NODE_IP: '86.48.22.209'
    LIVEKIT_TURN_SECRET: '${LIVEKIT_TURN_SECRET}'

  volumes:
    - '/opt/livekit/certs:/certs:ro'

  command:
    - '--node-ip'
    - '86.48.22.209'
    - '--bind'
    - '0.0.0.0'
    - '--config-body'
    - |
      port: 7880
      bind_addresses: ["0.0.0.0"]
      
      rtc:
        tcp_port: 7881
        port_range_start: 50000
        port_range_end: 51000
        use_external_ip: true
      
      turn:
        enabled: true
        domain: turn.appideax.com
        external_ips: ["86.48.22.209"]
        udp_port: 3478
        tls_port: 5349
        cert_file: /certs/turn/fullchain.pem
        key_file: /certs/turn/privkey.pem
        relay_range_start: 50000
        relay_range_end: 51000
      
      keys:
        ${LIVEKIT_API_KEY}: ${LIVEKIT_API_SECRET}
# services:
#   livekit:
#     image: 'livekit/livekit-server:v1.9.0'
#     container_name: livekit_server
#     restart: always
#     network_mode: "host"

#     environment:
#       LIVEKIT_API_KEY: '${LIVEKIT_API_KEY}'
#       LIVEKIT_API_SECRET: '${LIVEKIT_API_SECRET}'
#       LIVEKIT_NODE_IP: '${LIVEKIT_NODE_IP}'
#       LIVEKIT_TURN_SECRET: '${LIVEKIT_TURN_SECRET}'

#     volumes:
#       - '/opt/livekit/certs:/certs:ro'

#     command:
#       - '--node-ip'
#       - '86.48.22.209'
#       - '--bind'
#       - '0.0.0.0'
#       - '--config-body'
#       - |
#         port: 7880
#         rtc:
#           tcp_port: 7881
#           port_range_start: 50000
#           port_range_end: 51000
#           use_external_ip: true
        
#         turn:
#           enabled: true
#           domain: turn.appideax.com
#           udp_port: 3478
#           tls_port: 5349
#           cert_file: /certs/turn/fullchain.pem
#           key_file: /certs/turn/privkey.pem
#           relay_range_start: 50000
#           relay_range_end: 51000
        
#         keys:
#           ${LIVEKIT_API_KEY}: ${LIVEKIT_API_SECRET}
          
